<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Findo Search Engine</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }

      .header {
        text-align: center;
        margin-bottom: 3rem;
      }

      .header h1 {
        color: white;
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
      }

      .header p {
        color: rgba(255, 255, 255, 0.9);
        font-size: 1.2rem;
      }

      .search-container {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        margin-bottom: 2rem;
      }

      .search-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .input-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .search-input {
        flex: 1;
        min-width: 300px;
        padding: 1rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .num-results {
        padding: 1rem;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-size: 1rem;
        width: 150px;
      }

      .search-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        color: white;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #f7cf4d 0%, #fa8565 100%);
        color: white;
        padding: 0.5rem 1rem;
        opacity: 0;
        transform: translateY(-5px);
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .btn-summary {
        background: linear-gradient(135deg, #4d72f7 0%, #1f0d81 100%);
        color: white;
        padding: 0.5rem 1rem;
        opacity: 0;
        transform: translateY(-5px);
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .results-container {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        display: none;
      }

      .results-header {
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid #f0f0f0;
      }

      .results-header h2 {
        color: #333;
        margin-bottom: 0.5rem;
      }

      .results-count {
        color: #666;
        font-size: 0.9rem;
      }

      .result-item {
        padding: 1.5rem;
        margin-bottom: 1rem;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        transition: all 0.3s ease;
      }

      .result-item:hover {
        border-color: #667eea;
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        transform: translateY(-2px);
      }

      .result-item:hover .btn-secondary,
      .result-item:hover .btn-summary {
        opacity: 1;
        transform: translateY(0);
        pointer-events: auto;
      }

      .result-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #333;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .result-id {
        font-size: 0.8rem;
        color: #999;
        margin-bottom: 0.5rem;
      }

      .result-content {
        color: #666;
        line-height: 1.6;
      }

      .loading {
        text-align: center;
        padding: 2rem;
        color: #666;
      }

      .loading::after {
        content: "...";
        animation: dots 2s infinite;
      }

      .highlight {
        font-weight: bold;
        padding: 0 2px;
        border-radius: 3px;
      }

      .toggle-btn {
        border: 1px solid #185a9d;
        margin-left: 5px;
        padding: 3px 6px;
        border-radius: 5px;
        background: #185a9d;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: color 0.1s ease 0.1s, background-color 0.1s ease 0.1s;
      }

      .toggle-btn:hover {
        background-color: #5d92c8;
        color: white;
      }

      .toggle-btn2 {
        border: 1px solid #185a9d;
        margin-left: 5px;
        padding: 3px 6px;
        border-radius: 5px;
        background: #185a9d;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: color 0.1s ease 0.1s, background-color 0.1s ease 0.1s;
      }

      .toggle-btn2:hover {
        background-color: #5d92c8;
        color: white;
      }

      #similarResultsContainer {
        margin-bottom: 2rem;
      }

      #answerContainer {
        margin-bottom: 2rem;
      }

      .spinner {
        margin: 20px auto;
        border: 6px solid #f3f3f3;
        border-top: 6px solid #4285f4;
        border-radius: 50%;
        width: 32px;
        height: 32px;
        animation: spin 0.9s linear infinite;
      }

      .loading-text {
        text-align: center;
        margin-top: 8px;
        font-size: 14px;
        color: #555;
        font-style: italic;
      }

      .skeleton-full {
        background: linear-gradient(
          90deg,
          #e0e0e0 25%,
          #f1f1f1 50%,
          #e0e0e0 75%
        );
        background-size: 200% 100%;
        animation: shimmer 1.2s infinite;
        border-radius: 6px;
        width: 100%;
      }

      .skeleton-label {
        font-size: 1rem;
        letter-spacing: 0.5px;
      }

      #didYouMean:hover {
        text-decoration: underline;
      }

      @keyframes shimmer {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }

      .skeleton-box {
        margin-top: 10px;
      }

      .skeleton-line {
        height: 14px;
        width: 100%;
        margin-bottom: 10px;
      }

      .skeleton-line.short {
        width: 60%;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes dots {
        0%,
        20% {
          content: "";
        }
        40% {
          content: ".";
        }
        60% {
          content: "..";
        }
        80%,
        100% {
          content: "...";
        }
      }

      .error {
        background: #fee;
        color: #c33;
        padding: 1rem;
        border-radius: 10px;
        border: 1px solid #fcc;
        margin: 1rem 0;
      }

      .no-results {
        text-align: center;
        padding: 3rem;
        color: #666;
      }

      .no-results h3 {
        margin-bottom: 1rem;
        color: #999;
      }

      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }

        .header h1 {
          font-size: 2rem;
        }

        .input-group {
          flex-direction: column;
        }

        .search-input {
          min-width: auto;
        }

        .search-buttons {
          flex-direction: column;
        }
      }

      @keyframes contentSlideUp {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .slide-animate {
        animation: contentSlideUp 0.45s ease-out forwards;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üïµÔ∏è Findo</h1>
      </div>

      <div class="search-container">
        <form class="search-form" id="searchForm">
          <div class="input-group">
            <input
              type="text"
              class="search-input"
              id="queryInput"
              placeholder="Enter your search query..."
              required
            />
            <input
              type="number"
              class="num-results"
              id="numResultsInput"
              placeholder="Results"
              min="1"
              max="100"
              value="10"
            />
          </div>

          <div style="display: none; margin-top: 5px" id="errorContainer">
            <span style="color: #000">Did you mean: </span>
            <span
              id="didYouMean"
              style="
                color: rgb(49, 59, 205);
                font-style: italic;
                cursor: pointer;
              "
            ></span>
          </div>

          <div class="search-buttons">
            <button type="submit" class="btn btn-primary" id="searchBtn">
              üîç Search
            </button>
          </div>
        </form>
      </div>

      <div class="results-container" id="answerContainer" style="display: none">
        <div class="results-header">
          <h2>Answer</h2>
        </div>
        <div id="answerLoader" class="spinner" style="display: none"></div>
        <div id="loadingText" class="loading-text" style="display: none">
          Loading answer...
        </div>
        <div id="answerContent"></div>
      </div>

      <div class="results-container" id="similarResultsContainer">
        <div class="results-header">
          <h2>Similar documents found based on this one:</h2>
        </div>
        <div id="searchedDoc"></div>
      </div>

      <div class="results-container" id="resultsContainer">
        <div class="results-header">
          <h2>Search Results</h2>
          <div class="results-count" id="resultsCount"></div>
        </div>
        <div id="resultsContent"></div>
      </div>
    </div>

    <script>
      const summaryCache = {};
      const API_BASE_URL = "/api/v1";

      const searchForm = document.getElementById("searchForm");
      const queryInput = document.getElementById("queryInput");
      const numResultsInput = document.getElementById("numResultsInput");
      const searchBtn = document.getElementById("searchBtn");
      const resultsContainer = document.getElementById("resultsContainer");
      const similarResultsContainer = document.getElementById(
        "similarResultsContainer"
      );
      const resultsCount = document.getElementById("resultsCount");
      const searchedDoc = document.getElementById("searchedDoc");
      const resultsContent = document.getElementById("resultsContent");

      let stopwords = new Set();

      async function loadStopwords() {
        try {
          const response = await fetch("../data/pt-stopwords.txt")
            .then((response) => response.text())
            .then((text) => {
              console.log(text);
              return text;
            });
          if (!response.ok) throw new Error("Could not load stopwords file");
          const text = await response.text();
          stopwords = new Set(
            text
              .split(/\r?\n/)
              .map((w) => w.trim().toLowerCase())
              .filter(Boolean)
          );
        } catch (error) {
          console.error("Stopwords could not be loaded:", error);
        }
      }

      searchForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        await performSearch();
      });

      async function performSearch() {
        const query = queryInput.value.trim();
        const numResults = parseInt(numResultsInput.value) || 10;

        resultsContainer.style.display = "none";
        similarResultsContainer.style.display = "none";
        document.getElementById("answerContainer").style.display = "none";

        let is_question = false;

        try {
          const correctResponse = await fetch(
            `${API_BASE_URL}/correct_query?query=${encodeURIComponent(query)}`
          );

          if (!correctResponse.ok) {
            throw new Error(
              `HTTP ${correctResponse.status}: ${correctResponse.statusText}`
            );
          }

          const corrected_query = await correctResponse.json();
          const didYouMeanDiv = document.getElementById("didYouMean");
          const errorContainer = document.getElementById("errorContainer");

          if (
            corrected_query &&
            corrected_query.toLowerCase() !== query.toLowerCase()
          ) {
            errorContainer.style.display = "block";
            didYouMeanDiv.innerHTML = `<strong>${escapeHtml(
              corrected_query
            )}</strong>?`;

            didYouMeanDiv.onclick = async () => {
              queryInput.value = corrected_query;
              errorContainer.style.display = "none";
              await performSearch();
            };
          } else {
            errorContainer.style.display = "none";
            didYouMeanDiv.onclick = null;
          }
        } catch (error) {
          console.error("Error correcting query:", error);
        }

        if (!query) {
          showError("Please enter a search query");
          return;
        }

        try {
          const isQuestionResponse = await fetch(
            `${API_BASE_URL}/is_question?query=${encodeURIComponent(query)}`
          );
          if (!isQuestionResponse.ok) {
            throw new Error(
              `HTTP ${isQuestionResponse.status}: ${isQuestionResponse.statusText}`
            );
          }
          const isQuestion = await isQuestionResponse.json();
          is_question = isQuestion;
          console.log(`Is the query a question? ${isQuestion}`);
        } catch (error) {
          console.error("Error checking if query is a question:", error);
        }

        showLoading();

        if (is_question) {
          showAnswerLoader();
        } else {
          document.getElementById("answerContainer").style.display = "none";
        }
        try {
          const response = await fetch(
            `${API_BASE_URL}/search?query=${encodeURIComponent(
              query
            )}&num_results=${numResults}`
          );

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();
          displayResults(data.results, `Search results for "${query}"`);

          console.log("is question:", is_question);
          console.log(typeof is_question);

          if (data.results.length > 0 && is_question) {
            try {
              const bestDocContent = data.results[0].content;
              const answerResponse = await fetch(
                `${API_BASE_URL}/generate_answer?query=${encodeURIComponent(
                  query
                )}&document_content=${encodeURIComponent(bestDocContent)}`
              );
              if (!answerResponse.ok) {
                throw new Error(
                  `HTTP ${answerResponse.status}: ${answerResponse.statusText}`
                );
              }
              let answerData = await answerResponse.text();
              answerData = JSON.parse(answerData);
              console.log("Generated answer:", answerData);

              displayAnswer(answerData);
            } catch (error) {
              console.error("Error generating answer:", error);
            }
          }
        } catch (error) {
          showError(`Search failed: ${error.message}`);
        }
      }

      async function performSimilarSearch(docId) {
        const numResults = parseInt(numResultsInput.value) || 10;

        similarResultsContainer.style.display = "block";
        similarResultsContainer.classList.remove("slide-animate");
        requestAnimationFrame(() => {
          similarResultsContainer.classList.add("slide-animate");
        });
        searchedDoc.innerHTML = '<div class="loading">Searching</div>';
        setButtonsEnabled(false);
        resultsContainer.style.display = "none";

        searchedDocument = null;

        try {
          const responseDoc = await fetch(
            `${API_BASE_URL}/search_doc?doc_id=${docId}`
          );

          if (!responseDoc.ok) {
            throw new Error(
              `HTTP ${responseDoc.status}: ${responseDoc.statusText}`
            );
          }

          const dataDoc = await responseDoc.json();
          searchedDocument = dataDoc.results[0].content;
          displaySearchedDoc(dataDoc.results[0]);
          if (dataDoc.results.length === 0) {
            showError(`Document with ID ${docId} not found`);
            return;
          }
        } catch (error) {
          showError(`Document retrieval failed: ${error.message}`);
          return;
        }

        showLoading();

        try {
          const response = await fetch(
            `${API_BASE_URL}/search_like?doc_id=${docId}&query=${encodeURIComponent(
              searchedDocument
            )}&num_results=${numResults}`
          );

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const data = await response.json();

          displayResults(data.results, `Documents similar to ID ${docId}`);
        } catch (error) {
          showError(`Similarity search failed: ${error.message}`);
        }
      }

      function attachToggle(contentBox) {
        const btn = contentBox.querySelector(".toggle-btn");
        if (!btn) return;

        btn.addEventListener("click", () => {
          const shortText = contentBox.querySelector(".short-text");
          const fullText = contentBox.querySelector(".full-text");

          const expanded = fullText.style.display === "inline";
          if (expanded) {
            fullText.style.display = "none";
            shortText.style.display = "inline";
            btn.textContent = "Show more";
          } else {
            fullText.style.display = "inline";
            shortText.style.display = "none";
            btn.textContent = "Show less";
          }
        });
      }

      async function summarizeText(docId) {
        const btn = document.querySelector(
          `button.btn-summary[data-id="${docId}"]`
        );
        const resultItem = btn.closest(".result-item");
        const contentBox = resultItem.querySelector(".result-content");

        if (summaryCache[docId]) {
          const cached = summaryCache[docId];

          if (contentBox.innerHTML === cached.summaryHTML) {
            contentBox.innerHTML = cached.originalHTML;
            btn.textContent = "‚ú® Summarize";
          } else {
            contentBox.innerHTML = cached.summaryHTML;
            btn.textContent = "‚Ü© Show Original";
          }

          attachToggle(contentBox);
          return;
        }

        const originalHTML = contentBox.innerHTML;
        const originalHeight = contentBox.offsetHeight;
        contentBox.innerHTML = `
        <div class="skeleton-wrapper" style="height:${originalHeight}px; overflow:hidden; position:relative;">
            <div class="skeleton-full" style="height:100%;"></div>
            <div id="loader-${docId}" class="skeleton-label"
                 style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);">
                 Generating summary<span class="dots"></span>
            </div>
        </div>
    `;

        let dotCount = 0;
        const loaderDots = setInterval(() => {
          dotCount = (dotCount + 1) % 4;
          document.querySelector(`#loader-${docId} .dots`).textContent =
            ".".repeat(dotCount);
        }, 400);

        let docText = "";
        try {
          const response = await fetch(
            `${API_BASE_URL}/search_doc?doc_id=${docId}`
          );
          const data = await response.json();
          docText = data.results[0].content;
        } catch (err) {
          showError("Document retrieval failed: " + err.message);
          clearInterval(loaderDots);
          return;
        }

        let summaryText = "";
        try {
          const response = await fetch(
            `${API_BASE_URL}/summarize?text=${encodeURIComponent(docText)}`
          );
          const data = await response.json();
          summaryText = escapeHtml(data || "(No summary returned)");
        } catch (err) {
          showError("Summarization failed: " + err.message);
          clearInterval(loaderDots);
          return;
        }

        clearInterval(loaderDots);

        const summaryHTML = `
        <div class="summary-content">
            <strong>Summary:</strong><br><br>${summaryText}
        </div>
    `;

        summaryCache[docId] = {
          originalHTML: originalHTML,
          summaryHTML: summaryHTML,
        };

        contentBox.innerHTML = summaryHTML;
        btn.textContent = "‚Ü© Show Original";

        attachToggle(contentBox);
      }

      function showLoading() {
        resultsContainer.style.display = "block";
        resultsContent.innerHTML = '<div class="loading">Searching</div>';
        resultsCount.textContent = "";
        setButtonsEnabled(false);
      }

      function highlightQuery(text, query) {
        if (!query) return text;
        const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
        const words = escapedQuery
          .split(/\s+/)
          .map((w) => w.toLowerCase())
          .filter((w) => w && !stopwords.has(w));
        if (words.length === 0) return text;
        const regex = new RegExp(`\\b(${words.join("|")})\\b`, "gi");
        return text.replace(
          regex,
          (match) => `<span class="highlight">${match}</span>`
        );
      }

      function displaySearchedDoc(doc) {
        const content = escapeHtml(doc.content);
        const shortContent = content.slice(0, 400);
        const highlightedShort =
          shortContent + (content.length > 400 ? "..." : "");
        const highlightedFull = content;

        searchedDoc.innerHTML = `
        <div class="result-item">
          <div class="result-title">${escapeHtml(doc.title)}</div>
          <div class="result-id">ID: ${doc.id}</div>

      <div class="result-content">
        <span class="short-text2">${highlightedShort}</span>
        ${
          content.length > 400
            ? `
              <span class="full-text2" style="display:none;">${highlightedFull}</span>
              <button class="toggle-btn2">Show more</button>
            `
            : ""
        }
      </div>
    </div>
  `;

        const btn2 = searchedDoc.querySelector(".toggle-btn2");
        if (btn2) {
          btn2.addEventListener("click", () => {
            const shortText2 = searchedDoc.querySelector(".short-text2");
            const fullText2 = searchedDoc.querySelector(".full-text2");

            const expanded2 = fullText2.style.display === "inline";
            if (expanded2) {
              fullText2.style.display = "none";
              shortText2.style.display = "inline";
              btn2.textContent = "Show more";
            } else {
              fullText2.style.display = "inline";
              shortText2.style.display = "none";
              btn2.textContent = "Show less";
            }
          });
        }
      }

      function displayResults(results, title) {
        resultsContainer.style.display = "block";

        resultsContainer.classList.remove("slide-animate");
        requestAnimationFrame(() => {
          resultsContainer.classList.add("slide-animate");
        });

        resultsCount.textContent = `Found ${results.length} results`;

        if (results.length === 0) {
          resultsContent.innerHTML = `
          <div class="no-results">
            <h3>No results found</h3>
            <p>Try adjusting your search terms or check your spelling.</p>
          </div>`;
          return;
        }

        const query = queryInput.value.trim();
        const highlightedResults = results.map((result) => {
          const content = escapeHtml(result.content);
          const highlightedFull = highlightQuery(content, query);

          const rawSnippet =
            result.snippet && result.snippet.trim().length > 0
              ? result.snippet
              : result.content.slice(0, 400) +
                (result.content.length > 400 ? "..." : "");

          const snippetEscaped = escapeHtml(rawSnippet);
          const highlightedSnippet = highlightQuery(snippetEscaped, query);

          return `
          <div class="result-item">
            <div class="result-title">
              ${escapeHtml(result.title)}
            <div>

              <button class="btn btn-summary " data-id="${result.id}">
                ‚ú®Summarize
              </button>
              <button class="btn btn-secondary search-like-inline" data-id="${
                result.id
              }">
                 üîç Search Similar
              </button>
              </div>
            </div>
            <div class="result-id">ID: ${result.id}</div>
            <div class="result-content">
              <span class="short-text">
            ${highlightedSnippet}
          </span>

              ${
                result.content.length > 400
                  ? `
                <span class="full-text" style="display:none;">
                  ${highlightedFull}
                </span>
                    <button class="toggle-btn">Show more</button>
              `
                  : ""
              }
            </div>
          </div>
        `;
        });

        resultsContent.innerHTML = highlightedResults.join("");

        document.querySelectorAll(".toggle-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const content = btn.parentElement;
            const shortText = content.querySelector(".short-text");
            const fullText = content.querySelector(".full-text");

            const expanded = fullText.style.display === "inline";
            if (expanded) {
              fullText.style.display = "none";
              shortText.style.display = "inline";
              btn.textContent = "Show more";
            } else {
              fullText.style.display = "inline";
              shortText.style.display = "none";
              btn.textContent = "Show less";
            }
          });
        });

        document.querySelectorAll(".search-like-inline").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const docId = parseInt(btn.getAttribute("data-id"));
            await performSimilarSearch(docId);
          });
        });

        document.querySelectorAll(".btn-summary").forEach((btn) => {
          btn.addEventListener("click", async () => {
            const docId = parseInt(btn.getAttribute("data-id"));
            await summarizeText(docId);
          });
        });

        setButtonsEnabled(true);
      }

      function displayAnswer(text) {
        const box = document.getElementById("answerContainer");
        const loader = document.getElementById("answerLoader");
        const content = document.getElementById("answerContent");

        loader.style.display = "none";
        loadingText.style.display = "none";

        content.innerHTML = `
              <div class="result-item">
                <div class="result-content">
                  ${escapeHtml(text)}
                </div>
              </div>
            `;

        box.classList.remove("slide-animate");
        box.style.display = "block";

        requestAnimationFrame(() => {
          box.classList.add("slide-animate");
        });
      }

      function showAnswerLoader() {
        const box = document.getElementById("answerContainer");
        const loader = document.getElementById("answerLoader");
        const loadingText = document.getElementById("loadingText");
        const content = document.getElementById("answerContent");

        content.innerHTML = "";
        loader.style.display = "block";
        loadingText.style.display = "block";
        box.style.display = "block";
      }

      function showError(message) {
        resultsContainer.style.display = "block";
        resultsContent.innerHTML = `<div class="error">${escapeHtml(
          message
        )}</div>`;
        resultsCount.textContent = "";
        setButtonsEnabled(true);
      }

      function setButtonsEnabled(enabled) {
        searchBtn.disabled = !enabled;
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      document.addEventListener("DOMContentLoaded", async () => {
        queryInput.focus();
        await loadStopwords();
        queryInput.placeholder =
          "Try searching for 'machine learning', 'python', or enter a document ID...";
      });
    </script>
  </body>
</html>
